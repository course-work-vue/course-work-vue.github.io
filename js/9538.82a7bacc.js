"use strict";(self["webpackChunkvue_3_authentication_jwt"]=self["webpackChunkvue_3_authentication_jwt"]||[]).push([[9538],{9538:function(e,s,t){t.r(s),t.d(s,{default:function(){return U}});var n=t(6768),i=t(5130),a=t(4232);const r={class:"mt-4 list"},o={class:"mb-3"},l={class:"col col-3 float-end"},u={key:0,class:"table"},c=(0,n.Lk)("tbody",null,[(0,n.Lk)("td",null,[(0,n.Lk)("div",{class:"skeleton skeleton-animate"})]),(0,n.Lk)("td",null,[(0,n.Lk)("div",{class:"skeleton skeleton-animate"})]),(0,n.Lk)("td",null,[(0,n.Lk)("div",{class:"skeleton skeleton-animate"})]),(0,n.Lk)("td",null,[(0,n.Lk)("div",{class:"skeleton skeleton-animate"})]),(0,n.Lk)("td",null,[(0,n.Lk)("div",{class:"skeleton skeleton-animate"})]),(0,n.Lk)("td",null,[(0,n.Lk)("div",{class:"skeleton skeleton-animate"})])],-1),h=[c],d={key:1,class:"table"},k=(0,n.Lk)("thead",null,[(0,n.Lk)("tr",null,[(0,n.Lk)("th",null,"Role Name"),(0,n.Lk)("th",null,"Create"),(0,n.Lk)("th",null,"Read"),(0,n.Lk)("th",null,"Update"),(0,n.Lk)("th",null,"Delete")])],-1),p=["onUpdate:modelValue"],m=["onUpdate:modelValue"],g=["onUpdate:modelValue"],P=["onUpdate:modelValue"],L={class:"float-start"},y={class:"pagination"},b=["onClick"];function v(e,s,t,c,v,f){return(0,n.uX)(),(0,n.CE)("div",r,[(0,n.Lk)("div",null,[(0,n.Lk)("div",o,[(0,n.Lk)("button",{onClick:s[0]||(s[0]=(...s)=>e.navigateToAddStudent&&e.navigateToAddStudent(...s)),class:"btn btn-primary",type:"button"},"Добавить студента"),(0,n.Lk)("div",l,[(0,n.bo)((0,n.Lk)("input",{class:"form-control","onUpdate:modelValue":s[1]||(s[1]=e=>v.searchQuery=e),onInput:s[2]||(s[2]=(...e)=>f.updateSearchQuery&&f.updateSearchQuery(...e)),placeholder:"Поиск..."},null,544),[[i.Jo,v.searchQuery]])])]),v.loading?((0,n.uX)(),(0,n.CE)("table",u,h)):((0,n.uX)(),(0,n.CE)("table",d,[k,(0,n.Lk)("tbody",null,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(f.groupedPermissions,((e,s)=>((0,n.uX)(),(0,n.CE)("tr",{key:s},[(0,n.Lk)("td",null,(0,a.v_)(e[0].RoleName),1),(0,n.Lk)("td",null,[(0,n.bo)((0,n.Lk)("input",{type:"checkbox","onUpdate:modelValue":e=>v.rolePermissions[s][0]=e},null,8,p),[[i.lH,v.rolePermissions[s][0]]])]),(0,n.Lk)("td",null,[(0,n.bo)((0,n.Lk)("input",{type:"checkbox","onUpdate:modelValue":e=>v.rolePermissions[s][1]=e},null,8,m),[[i.lH,v.rolePermissions[s][1]]])]),(0,n.Lk)("td",null,[(0,n.bo)((0,n.Lk)("input",{type:"checkbox","onUpdate:modelValue":e=>v.rolePermissions[s][2]=e},null,8,g),[[i.lH,v.rolePermissions[s][2]]])]),(0,n.Lk)("td",null,[(0,n.bo)((0,n.Lk)("input",{type:"checkbox","onUpdate:modelValue":e=>v.rolePermissions[s][3]=e},null,8,P),[[i.lH,v.rolePermissions[s][3]]])])])))),128))])])),(0,n.Lk)("button",{onClick:s[3]||(s[3]=(...e)=>f.savePermissions&&f.savePermissions(...e))},"Save Permissions"),(0,n.Lk)("nav",L,[(0,n.Lk)("ul",y,[(0,n.Lk)("li",{class:(0,a.C4)(["page-item",{disabled:1===v.currentPage}])},[(0,n.Lk)("button",{onClick:s[4]||(s[4]=(...e)=>f.prevPage&&f.prevPage(...e)),class:"page-link"},"Предыдущая страница")],2),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(f.pageRange,(e=>((0,n.uX)(),(0,n.CE)("li",{class:(0,a.C4)(["page-item",{active:e==v.currentPage}]),key:e},[(0,n.Lk)("button",{onClick:s=>f.changePage(e),class:"page-link"},(0,a.v_)(e),9,b)],2)))),128)),(0,n.Lk)("li",{class:(0,a.C4)(["page-item",{disabled:v.currentPage===f.totalPages}])},[(0,n.Lk)("button",{onClick:s[5]||(s[5]=(...e)=>f.nextPage&&f.nextPage(...e)),class:"page-link"},"Следующая страница")],2)])])])])}t(4114);var f=t(619),C={data(){return{permissions:[],currentPage:1,permissionsPerPage:10,maxPageButtons:3,loading:!0,searchQuery:"",rolePermissions:{}}},computed:{groupedPermissions(){const e=(this.currentPage-1)*this.permissionsPerPage,s=e+this.permissionsPerPage,t=this.filterpermissions(),n=t.slice(e,s),i={};return n.forEach((e=>{const s=e.RoleId;i[s]||(i[s]=[]),i[s].push(e),this.rolePermissions[s]||(this.rolePermissions[s]=[!1,!1,!1,!1]);const t=e.Operation;this.rolePermissions[s][t]=!0})),i},totalPages(){const e=this.filterpermissions();return Math.ceil(e.length/this.permissionsPerPage)},paginatedpermissions(){const e=(this.currentPage-1)*this.permissionsPerPage,s=e+this.permissionsPerPage,t=this.filterpermissions();return t.slice(e,s)},pageRange(){const e=this.totalPages,s=this.currentPage,t=this.maxPageButtons,n="...";if(e<=t)return Array.from({length:e},((e,s)=>s+1));const i=Math.floor(t/2);let a=Math.max(1,s-i),r=Math.min(e,a+t-1);r-a+1<t&&(a=r-t+1);const o=[];a>1&&o.push(1,n);for(let l=a;l<=r;l++)o.push(l);return r<e&&o.push(n,e),o}},methods:{savePermissions(){this.checkedPermissions=[],this.uncheckedPermissions=[],Object.keys(this.rolePermissions).forEach((e=>{this.rolePermissions[e].forEach(((s,t)=>{const n=this.permissions.find((s=>s.RoleId===parseInt(e)&&s.Operation===t));s&&!n?this.checkedPermissions.push({RoleId:parseInt(e),Operation:t}):!s&&n&&this.uncheckedPermissions.push(n)}))})),console.log("New Permissions to Insert:",this.checkedPermissions),console.log("Unchecked Permissions to Remove:",this.uncheckedPermissions)},async loadRightsTable(){const e=this.$route.params.table;try{const s=await f.A.getPermissionByTable(e);this.permissions=s.data,this.loading=!1}catch(s){console.error("Ошибка во время загрузки:",s)}},filterpermissions(){const e=this.searchQuery.toLowerCase();return this.permissions.filter((s=>String(s.RoleName).toLowerCase().includes(e)))},updateSearchQuery(){const e={page:1};""!==this.searchQuery.trim()&&(e.search=this.searchQuery),this.currentPage=1,this.$router.replace({query:e})},changePage(e){const s={...this.$route.query,page:e};""!==this.searchQuery.trim()&&(s.search=this.searchQuery),this.$router.replace({query:s})},prevPage(){this.currentPage>1&&this.changePage(this.currentPage-1)},nextPage(){this.currentPage<this.totalPages&&this.changePage(this.currentPage+1)}},beforeRouteUpdate(e,s,t){this.searchQuery=e.query.search||"",this.currentPage=parseInt(e.query.page)||1,t()},created(){const e=this.$route.query;this.currentPage=parseInt(e.page)||1,this.searchQuery=e.search||"",this.loadRightsTable()}},Q=t(1241);const R=(0,Q.A)(C,[["render",v]]);var U=R}}]);
//# sourceMappingURL=9538.82a7bacc.js.map