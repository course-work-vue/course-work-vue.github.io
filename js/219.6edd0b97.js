"use strict";(self["webpackChunkvue_3_authentication_jwt"]=self["webpackChunkvue_3_authentication_jwt"]||[]).push([[219],{219:function(e,t,s){s.r(t),s.d(t,{default:function(){return Q}});var a=s(6768),l=s(5130),o=s(4232);const i=e=>((0,a.Qi)("data-v-93bea264"),e=e(),(0,a.jt)(),e),r={class:"col col-xs-9 col-lg-12 mt-4 offset-md-1"},d={class:"col col-10 align-self-end"},c={class:"d-flex col-2 mb-2"},h=i((()=>(0,a.Lk)("div",{class:"col-2"},null,-1))),n={class:""},u=i((()=>(0,a.Lk)("label",{class:"form-check-label",for:"magistracyYes"}," Магистратура ",-1))),_=i((()=>(0,a.Lk)("div",{class:"col-1"},null,-1))),g={class:""},b=i((()=>(0,a.Lk)("label",{class:"form-check-label",for:"magistracyNo"}," Бакалавриат ",-1))),p={class:"d-flex col-10"},k={key:0,class:"table col-2",id:"table_dirs"},y=i((()=>(0,a.Lk)("thead",null,[(0,a.Lk)("tr",null,[(0,a.Lk)("th",null,"Направление")])],-1))),m=["onClick"],f={key:1,class:"table table-sm col-4",id:"table_subject"},v=i((()=>(0,a.Lk)("thead",null,[(0,a.Lk)("tr",null,[(0,a.Lk)("th",null,"Предмет")])],-1))),j=["onClick"],C={key:2,class:"table col-1",id:"table_group"},L=i((()=>(0,a.Lk)("thead",null,[(0,a.Lk)("tr",null,[(0,a.Lk)("th",null,"Группа")])],-1))),w=["onClick"],A={key:3,class:"table table-sm col-4",id:"table_teacher"},D=i((()=>(0,a.Lk)("thead",null,[(0,a.Lk)("tr",null,[(0,a.Lk)("th",null,"Преподаватель")])],-1))),E=["onClick"];function I(e,t,s,i,I,X){return(0,a.uX)(),(0,a.CE)("div",r,[(0,a.Lk)("div",{class:"col col-10 align-self-end",onChange:t[12]||(t[12]=e=>this.reloadData())},[(0,a.Lk)("div",d,[(0,a.Lk)("div",c,[(0,a.bo)((0,a.Lk)("select",{class:"form-select col-2 mr-2","onUpdate:modelValue":t[4]||(t[4]=e=>I.selected_course=e),value:"1"},[(0,a.Lk)("option",{value:"1",onClick:t[0]||(t[0]=e=>this.loadDirsData())},"1 курс"),(0,a.Lk)("option",{value:"2",onClick:t[1]||(t[1]=e=>this.loadDirsData())},"2 курс"),"0"==I.isMag?((0,a.uX)(),(0,a.CE)("option",{key:0,value:"3",onClick:t[2]||(t[2]=e=>this.loadDirsData())},"3 курс")):(0,a.Q3)("",!0),"0"==I.isMag?((0,a.uX)(),(0,a.CE)("option",{key:1,value:"4",onClick:t[3]||(t[3]=e=>this.loadDirsData())},"4 курс")):(0,a.Q3)("",!0)],512),[[l.u1,I.selected_course,void 0,{number:!0}]]),h,(0,a.bo)((0,a.Lk)("select",{class:"form-select col-2","onUpdate:modelValue":t[7]||(t[7]=e=>I.selected_sem=e),value:"1"},[(0,a.Lk)("option",{value:"1",onClick:t[5]||(t[5]=e=>this.loadDirsData())},"1 семестр"),(0,a.Lk)("option",{value:"2",onClick:t[6]||(t[6]=e=>this.loadDirsData())},"2 семестр")],512),[[l.u1,I.selected_sem,void 0,{number:!0}]])]),(0,a.Lk)("div",{class:"d-flex col-6",onClick:t[10]||(t[10]=e=>this.loadDirsData())},[(0,a.Lk)("div",n,[(0,a.bo)((0,a.Lk)("input",{class:"form-check-input",type:"radio",name:"magistracy",id:"magistracyYes",value:"1","onUpdate:modelValue":t[8]||(t[8]=e=>I.isMag=e)},null,512),[[l.XL,I.isMag]]),u]),_,(0,a.Lk)("div",g,[(0,a.bo)((0,a.Lk)("input",{class:"form-check-input",type:"radio",name:"magistracy",id:"magistracyNo",value:"0","onUpdate:modelValue":t[9]||(t[9]=e=>I.isMag=e),checked:""},null,512),[[l.XL,I.isMag]]),b])])]),(0,a.Lk)("div",p,[this.dir_loaded?((0,a.uX)(),(0,a.CE)("table",k,[y,(0,a.Lk)("tbody",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(I.dirs,(e=>((0,a.uX)(),(0,a.CE)("tr",{key:e.dir_id},[(0,a.Lk)("th",{onClick:t=>{this.selected_dir=e.dirId,X.loadSubjectsData(e.dirCode)},class:(0,o.C4)({"table-active":this.selected_dir==e.dirId})},(0,o.v_)(e.dirCode),11,m)])))),128))])])):(0,a.Q3)("",!0),this.sub_loaded?((0,a.uX)(),(0,a.CE)("table",f,[v,(0,a.Lk)("tbody",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(this.subjects,(e=>((0,a.uX)(),(0,a.CE)("tr",{key:e.subject_id},[(0,a.Lk)("th",{onClick:t=>{this.selected_subject=e,X.findSubject(e),console.log(this.selected_subject_obj),X.loadGroupsData(this.selected_dir)},class:(0,o.C4)({"table-active":this.selected_subject==e})},(0,o.v_)(e),11,j)])))),128))])])):(0,a.Q3)("",!0),this.group_loaded?((0,a.uX)(),(0,a.CE)("table",C,[L,(0,a.Lk)("tbody",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(this.groups,(e=>((0,a.uX)(),(0,a.CE)("tr",{key:e.group_id},[(0,a.Lk)("th",{onClick:t=>{this.selected_group=e.group_id,this.selected_group_obj=e,this.loadTeachersData(),this.loadWorkloads()},class:(0,o.C4)({"table-active":this.selected_group==e.group_id,"text-success bold":-1!=this.selected_subject_id})},(0,o.v_)(e.group_number),11,w)])))),128))])])):(0,a.Q3)("",!0),this.teacher_loaded?((0,a.uX)(),(0,a.CE)("table",A,[D,(0,a.Lk)("tbody",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(this.teachers,(e=>((0,a.uX)(),(0,a.CE)("tr",{key:e.teacherId},[(0,a.Lk)("th",{onClick:t=>{this.selected_teacher=e.teacherId,this.selected_teacher_obj=e},class:(0,o.C4)({"table-active":this.selected_teacher==e.teacherId,"table-success":!1})},(0,o.v_)(e.lastName),11,E)])))),128))])])):(0,a.Q3)("",!0)]),(0,a.Lk)("div",null,[-1!=I.selected_teacher?((0,a.uX)(),(0,a.CE)("button",{key:0,class:"btn btn-primary btn-block",onClick:t[11]||(t[11]=e=>{X.saveRel()})}," Сохранить связь ")):(0,a.Q3)("",!0),(0,a.bF)(l.eB,{name:"fade"},{default:(0,a.k6)((()=>[this.showNotification?((0,a.uX)(),(0,a.CE)("div",{key:0,class:(0,o.C4)([{alert_success:I.not_suc,alert_attention:I.not_upd,alert_error:I.not_ex},"alert col-4"])},(0,o.v_)(this.notify_text),3)):(0,a.Q3)("",!0)])),_:1})])],32)])}s(4114),s(3375),s(9225),s(3972),s(9209),s(5714),s(7561),s(6197);var X=s(619),x={data(){return{selected_course:1,selected_sem:1,isMag:!1,dirs:[],groups:[],subjects:[],teachers:[],tgz:[],wl:[],teacher_load:[],selected_dir:-1,selected_group:-1,selected_group_obj:null,selected_subject:-1,selected_subject_obj:null,selected_subject_id:-1,selected_teacher:-1,selected_teacher_obj:null,dir_loaded:!1,sub_loaded:!1,group_loaded:!1,teacher_loaded:!1,saved_num:-1,saved_group:0,saved_subject:0,saved_teacher:0,saved:!1,t_loading:!0,s_loading:!0,wl_loading:!0,loading:!0,notify_text:"123",showNotification:!1,searchQuery:"",not_suc:!1,not_upd:!1,not_ex:!1}},methods:{async loadDirsData(){try{const e=await X.A.getAllDirections();this.dirs=Array.isArray(e.data)?e.data.filter((e=>e.magister==this.isMag)):[e.data.filter((e=>e.magister==this.isMag))],this.loading=!1,this.dir_loaded=!0,this.sub_loaded=!1,this.group_loaded=!1,this.teacher_loaded=!1}catch(e){console.error("Error loading groups data:",e)}},async loadTeacherGruz(){try{const e=await X.A.getAllTeachGruz();this.tgz=Array.isArray(e.data)?e.data:[e.data]}catch(e){console.error("Error loading tgz data:",e)}},async loadSubjectsData(e){try{const t=this.tgz.filter((t=>t.codeNapr===e&&t.kurs===this.selected_course&&t.semestr===this.selected_sem)),s=[...new Set(t.map((e=>e.disName)))];this.subjects=s,this.sub_loaded=!0,this.group_loaded=!1,this.teacher_loaded=!1}catch(t){console.error("Error loading subjects data:",t)}},async findSubject(e){try{const t=await X.A.getAllSubjects(),s=Array.isArray(t.data)?t.data:[t.data],a=s.find((t=>t.subjectName===e));this.selected_subject_obj=s.find((t=>t.subjectName===e)),this.selected_subject_id=a?a.subjectId:null}catch(t){console.error("Error loading subjects data:",t)}},async loadGroupsData(){try{const e=await X.A.getAllGroups();this.groups=Array.isArray(e.data)?e.data:[e.data],this.groups=this.groups.filter((e=>e.course===this.selected_course)),this.group_loaded=!0,this.teacher_loaded=!1}catch(e){console.error("Error loading groups data:",e)}},async loadTeachersData(){try{const e=await X.A.getAllTeachers();this.teachers=Array.isArray(e.data)?e.data:[e.data];const t=[...new Set(this.tgz.filter((e=>e.disName===this.selected_subject)).map((e=>e.fam)))];this.teachers=this.teachers.filter((e=>t.includes(e.lastName))),this.teacher_loaded=!0}catch(e){console.error("Error loading teachers data:",e)}},async loadWorkloads(){try{const e=await X.A.getAllWorkloads();this.wl=Array.isArray(e.data)?e.data:[e.data],console.log(this.wl)}catch(e){console.error("Error loading employments data:",e)}},saveRel(){console.log("sel_gr : "+this.selected_group),console.log("sel_su : "+this.selected_subject_id);let e=this.findWl(this.selected_group,this.selected_subject_id);if(-1==e)X.A.addWorkload(this.selected_group,this.selected_subject_id,this.selected_teacher,this.selected_group_obj,this.selected_subject_obj,this.selected_teacher_obj),this.notify_text="Связь добавлена",this.not_suc=!0,this.not_upd=!1,this.not_ex=!1;else{if(e==this.selected_teacher)return console.log("Такая запись уже есть"),this.notify_text="Такая связь уже есть",this.not_suc=!1,this.not_upd=!1,this.not_ex=!0,this.showNotification=!0,void setTimeout((()=>{this.showNotification=!1}),3e3);console.log("cur_teacher = "+e),console.log("selected = "+this.selected_teacher);var t=this.findWlID(this.selected_group,this.selected_subject_id);console.log("wlid = "+t),X.A.editWorkload(t,this.selected_teacher),this.notify_text="Связь обновлена",this.not_suc=!1,this.not_upd=!0,this.not_ex=!1}this.loadWorkloads(),this.loadTeachersData(this.selected_subject_id);while(1==this.loading&&1==this.wl_loading)this.findWl(this.selected_group,this.selected_subject_id);this.saved=!0,this.showNotification=!0,setTimeout((()=>{this.showNotification=!1}),3e3)},findWl(e,t){var s;for(s in this.wl)if(this.wl[s].groupId==e&&this.wl[s].subjectId==t)return this.wl[s].teacherId;return-1},findWlID(e,t){var s;for(s in this.wl)if(this.wl[s].groupId==e)return this.wl[s].subjectId==t&&console.log(this.wl[s]),this.wl[s].wlId;return this.s_loading=!1,-1},async loadGroups(e){try{const t=await X.A.getGroupByDir(e);this.groups=Array.isArray(t.data)?t.data:[t.data],this.s_loading=!1}catch(t){console.error("Error loading employments data:",t)}},async loadEmploymentData(){try{const e=await X.A.getAllEmployments();this.employment=Array.isArray(e.data)?e.data:[e.data],this.loading=!1}catch(e){console.error("Error loading employments data:",e)}},async loadTeacherLoad(e){try{var t=[];for(let a=0;a<e.length;a++){const l=e[a],o=await X.A.getSubjectsForTeacher(l.teacher_id);var s=Array.isArray(o.data)?o.data:[o.data];"Пустой вывод."==s?t.push([]):t.push(s)}this.teacher_load=t,this.loading=!1,this.t_loading=!1}catch(a){console.error("Error loading employments data:",a)}},viewGroupDetail(e){this.$router.push(`/groups/${e}`)},viewRightsDetail(){this.$router.push("/Rights/groups")},contains(e,t){var s;for(s in t)if(t[s]===e)return!0;return!1},teachersForSub(e){var t=[];return this.employment.forEach((function(s){e==s.subject_id&&t.push(s)})),t},loadData(){this.loadDirsData(),this.loadTeacherGruz()},reloadData(){this.teacher_loaded?console.log(this.teacher_loaded):this.group_loaded?console.log(this.group_loaded):this.sub_loaded?console.log(this.sub_loaded):console.log(this.dir_loaded),this.loadWorkloads()}},created(){const e=this.$route.query;this.currentPage=parseInt(e.page)||1,this.searchQuery=e.search||"",this.loadData()}},N=s(1241);const W=(0,N.A)(x,[["render",I],["__scopeId","data-v-93bea264"]]);var Q=W}}]);
//# sourceMappingURL=219.6edd0b97.js.map